{"ast":null,"code":"import { USER_LOADING, REGISTER_FAIL, USER_LOADED, AUTH_ERROR, LOGIN_SUCCESS, LOGIN_FAIL, LOGOUT_SUCCESS, REGISTER_SUCCESS } from \"./actions\";\nimport { returnErrors, clearErrors } from './errorReducer';\nimport { testAPI } from \"../../api/api\";\nconst initialState = {\n  token: localStorage.getItem(\"token\") || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjVlOWViZmQyM2YzNzBlMGU4NzBiNzAxMSIsImlhdCI6MTU4NzQ2MjA5OCwiZXhwIjoxNTg3NDY1Njk4fQ.R9uDqq6r4q_pYNFwnmQ3nQ41htaM456l9CnVmavbtOY\",\n  isAuth: null,\n  isLoading: false,\n  user: null\n};\n\nconst authTestReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case USER_LOADING:\n      return { ...state,\n        isLoading: true\n      };\n\n    case USER_LOADED:\n      return { ...state,\n        isLoading: false,\n        isAuth: true,\n        user: action.payload\n      };\n\n    case LOGIN_SUCCESS:\n    case REGISTER_SUCCESS:\n      localStorage.setItem('token', action.payload.token);\n      return { ...state,\n        ...action.payload,\n        isAuth: true,\n        isLoading: false\n      };\n\n    case AUTH_ERROR:\n    case LOGIN_FAIL:\n    case REGISTER_FAIL:\n    case LOGOUT_SUCCESS:\n      localStorage.removeItem('token');\n      return { ...state,\n        isAuth: false,\n        isLoading: false,\n        user: null,\n        token: null\n      };\n\n    default:\n      return state;\n  }\n};\n\nexport const userLoad = payload => ({\n  type: USER_LOADED,\n  payload\n});\nexport const getAuth = () => async (dispatch, getState) => {\n  const token = getState().authtest.token;\n  debugger;\n  let response = await testAPI.getAuth(token);\n\n  if (response.token == null) {\n    debugger;\n    dispatch({\n      type: AUTH_ERROR\n    });\n  } else {\n    dispatch(userLoad(response.data));\n  }\n};\nexport const login = (email, password) => async dispatch => {\n  dispatch({\n    type: USER_LOADING\n  });\n  testAPI.login(email, password).then(response => {\n    dispatch(userLoad(response.data.user));\n    dispatch({\n      type: LOGIN_SUCCESS,\n      payload: response.data\n    });\n    dispatch(clearErrors(null, null, null));\n  }).catch(err => {\n    dispatch(returnErrors(err.response.data, err.response.status, 'LOGIN_FAIL'));\n    dispatch({\n      type: LOGIN_FAIL\n    });\n  });\n};\nexport const register = (name, email, password) => dispatch => {\n  testAPI.register(name, email, password).then(response => {\n    dispatch({\n      type: REGISTER_SUCCESS,\n      payload: response.data\n    });\n  }).catch(err => {\n    dispatch(returnErrors(err.response.data, err.response.status, 'REGISTER_FAIL'));\n    dispatch({\n      type: REGISTER_FAIL\n    });\n  });\n};\nexport const logout = () => ({\n  type: LOGOUT_SUCCESS\n});\nexport default authTestReducer;","map":{"version":3,"sources":["/Volumes/Anton/FullStack/myApp/client/src/redux/Test/authReducer.js"],"names":["USER_LOADING","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT_SUCCESS","REGISTER_SUCCESS","returnErrors","clearErrors","testAPI","initialState","token","localStorage","getItem","isAuth","isLoading","user","authTestReducer","state","action","type","payload","setItem","removeItem","userLoad","getAuth","dispatch","getState","authtest","response","data","login","email","password","then","catch","err","status","register","name","logout"],"mappings":"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","sourcesContent":["import {\n  USER_LOADING,\n  REGISTER_FAIL,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT_SUCCESS,\n  REGISTER_SUCCESS\n} from \"./actions\";\n\nimport {returnErrors,clearErrors} from './errorReducer'\nimport { testAPI } from \"../../api/api\";\n\n\nconst initialState = {\n  token: localStorage.getItem(\"token\")||\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjVlOWViZmQyM2YzNzBlMGU4NzBiNzAxMSIsImlhdCI6MTU4NzQ2MjA5OCwiZXhwIjoxNTg3NDY1Njk4fQ.R9uDqq6r4q_pYNFwnmQ3nQ41htaM456l9CnVmavbtOY\",\n  isAuth: null,\n  isLoading: false,\n  user:null,\n};\n\nconst authTestReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case USER_LOADING:\n      return { ...state, isLoading: true };\n    case USER_LOADED:\n      return { ...state, isLoading: false, isAuth: true, user: action.payload };\n    case LOGIN_SUCCESS:\n    case REGISTER_SUCCESS:\n      localStorage.setItem('token',action.payload.token)\n      return { ...state, ...action.payload, isAuth: true, isLoading: false };\n    case AUTH_ERROR:\n    case LOGIN_FAIL:\n    case REGISTER_FAIL:\n    case LOGOUT_SUCCESS:\n   localStorage.removeItem('token')\n      return {\n        ...state,\n        isAuth: false,\n        isLoading: false,\n        user: null,\n        token: null,\n      };\n    default:\n      return state;\n  }\n};\nexport const userLoad=(payload)=>({type:USER_LOADED,payload})\n\nexport const getAuth=()=>async (dispatch,getState)=>{\n  const token=getState().authtest.token;\n  debugger\n   let response=await testAPI.getAuth(token)\n   if(response.token==null){\n     debugger\n    dispatch({type:AUTH_ERROR})\n   }\n   else{\n    dispatch(userLoad(response.data))\n   }\n}\nexport const login = (email,password) => async(dispatch) => {\n  dispatch({type:USER_LOADING})\n  testAPI.login(email,password).then(response=>{\n    dispatch(userLoad(response.data.user))\n    dispatch({type:LOGIN_SUCCESS,payload:response.data})\n    dispatch(clearErrors(null,null,null))\n  }).catch(err=>{\n    dispatch(returnErrors(err.response.data,err.response.status,'LOGIN_FAIL'))\n    dispatch({type:LOGIN_FAIL})\n  })\n};\nexport const register=(name,email,password)=>dispatch=>{\n  testAPI.register(name,email,password).then(response=>{\n    dispatch({type:REGISTER_SUCCESS,payload:response.data})\n  }).catch(err=>{\n      dispatch(returnErrors(err.response.data,err.response.status,'REGISTER_FAIL'))\n       dispatch({type:REGISTER_FAIL})\n  })\n}\n\nexport const logout=()=>({type:LOGOUT_SUCCESS})\n\nexport default authTestReducer;\n"]},"metadata":{},"sourceType":"module"}